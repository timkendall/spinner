<html>
  <head>
    <title>My first Three.js app</title>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100%; }
      </style>
  </head>
  <body>
    <script src="bower_components/socket.io-client/socket.io.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r67/three.min.js"></script>

    <script>
      var socket = io('http://10.0.1.7:8000');
      var lastAccelData = new Date();

      var adjusts = {
        x: 0.02,
        y: 0.02,
        z: 0.02
      }

      socket.on('accel data', function (data) {
          adjusts.x = Math.abs(data.x) - Math.abs(data.x)*0.99;
          adjusts.y = Math.abs(data.y) - Math.abs(data.y)*0.99;
          adjusts.z = Math.abs(data.z) - Math.abs(data.z)*0.99;

          lastAccelData = new Date();
      });

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      var geometry = new THREE.BoxGeometry(1,1,1);
      var material = new THREE.MeshBasicMaterial({color: 0x77BDDF, wireframe: true});
      var cube = new THREE.Mesh(geometry, material);
      scene.add(cube);

      camera.position.z = 4;

      var render = function () {
        requestAnimationFrame(render);

        // Revert to old state if no new accel data
        var now = new Date();
        var timeSinceLast = (lastAccelData.getTime() - now.getTime()) / 1000;
        if (timeSinceLast > 3000) {
          adjusts.x = cube.rotation.y = cube.rotation.z = 0.02;
        }

        cube.rotation.x += adjusts.x;
        cube.rotation.y += adjusts.y;
        //cube.rotation.z += adjusts.z;

        renderer.render(scene, camera);

      };

      render();


    </script>



  </body>
</html>